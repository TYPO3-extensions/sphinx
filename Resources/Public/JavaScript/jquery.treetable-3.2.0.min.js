/*
 * jQuery treetable Plugin 3.2.0
 * http://ludo.cubicphuse.nl/jquery-treetable
 *
 * Copyright 2013, Ludo van den Boom
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
!function(a){var b,c,d;b=function(){function b(b,c,d){var e;this.row=b,this.tree=c,this.settings=d,this.id=this.row.data(this.settings.nodeIdAttr),e=this.row.data(this.settings.parentIdAttr),null!=e&&""!==e&&(this.parentId=e),this.treeCell=a(this.row.children(this.settings.columnElType)[this.settings.column]),this.expander=a(this.settings.expanderTemplate),this.indenter=a(this.settings.indenterTemplate),this.children=[],this.initialized=!1,this.treeCell.prepend(this.indenter)}return b.prototype.addChild=function(a){return this.children.push(a)},b.prototype.ancestors=function(){var a,b;for(b=this,a=[];b=b.parentNode();)a.push(b);return a},b.prototype.collapse=function(){return this.collapsed()?this:(this.row.removeClass("expanded").addClass("collapsed"),this._hideChildren(),this.expander.attr("title",this.settings.stringExpand),this.initialized&&null!=this.settings.onNodeCollapse&&this.settings.onNodeCollapse.apply(this),this)},b.prototype.collapsed=function(){return this.row.hasClass("collapsed")},b.prototype.expand=function(){return this.expanded()?this:(this.row.removeClass("collapsed").addClass("expanded"),this.initialized&&null!=this.settings.onNodeExpand&&this.settings.onNodeExpand.apply(this),a(this.row).is(":visible")&&this._showChildren(),this.expander.attr("title",this.settings.stringCollapse),this)},b.prototype.expanded=function(){return this.row.hasClass("expanded")},b.prototype.hide=function(){return this._hideChildren(),this.row.hide(),this},b.prototype.isBranchNode=function(){return this.children.length>0||!0===this.row.data(this.settings.branchAttr)},b.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch"),this.row.removeClass("leaf"),this.row.addClass(this.isBranchNode()?"branch":"leaf")},b.prototype.level=function(){return this.ancestors().length},b.prototype.parentNode=function(){return null!=this.parentId?this.tree[this.parentId]:null},b.prototype.removeChild=function(b){var c=a.inArray(b,this.children);return this.children.splice(c,1)},b.prototype.render=function(){var b,d,c=this.settings;return!0===c.expandable&&this.isBranchNode()&&(b=function(b){return a(this).parents("table").treetable("node",a(this).parents("tr").data(c.nodeIdAttr)).toggle(),b.preventDefault()},this.indenter.html(this.expander),d=!0===c.clickableNodeNames?this.treeCell:this.expander,d.off("click.treetable").on("click.treetable",b),d.off("keydown.treetable").on("keydown.treetable",function(a){13==a.keyCode&&b.apply(this,[a])})),this.indenter[0].style.paddingLeft=this.level()*c.indent+"px",this},b.prototype.reveal=function(){return null!=this.parentId&&this.parentNode().reveal(),this.expand()},b.prototype.setParent=function(a){return null!=this.parentId&&this.tree[this.parentId].removeChild(this),this.parentId=a.id,this.row.data(this.settings.parentIdAttr,a.id),a.addChild(this)},b.prototype.show=function(){return this.initialized||this._initialize(),this.row.show(),this.expanded()&&this._showChildren(),this},b.prototype.toggle=function(){return this.expanded()?this.collapse():this.expand(),this},b.prototype._hideChildren=function(){var a,b,c,d,e;for(d=this.children,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a.hide());return e},b.prototype._initialize=function(){var a=this.settings;return this.render(),!0===a.expandable&&"collapsed"===a.initialState?this.collapse():this.expand(),null!=a.onNodeInitialized&&a.onNodeInitialized.apply(this),this.initialized=!0},b.prototype._showChildren=function(){var a,b,c,d,e;for(d=this.children,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a.show());return e},b}(),c=function(){function c(a,b){this.table=a,this.settings=b,this.tree={},this.nodes=[],this.roots=[]}return c.prototype.collapseAll=function(){var a,b,c,d,e;for(d=this.nodes,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a.collapse());return e},c.prototype.expandAll=function(){var a,b,c,d,e;for(d=this.nodes,e=[],b=0,c=d.length;b<c;b++)a=d[b],e.push(a.expand());return e},c.prototype.findLastNode=function(a){return a.children.length>0?this.findLastNode(a.children[a.children.length-1]):a},c.prototype.loadRows=function(c){var d,e,f;if(null!=c)for(f=0;f<c.length;f++)e=a(c[f]),null!=e.data(this.settings.nodeIdAttr)&&(d=new b(e,this.tree,this.settings),this.nodes.push(d),this.tree[d.id]=d,null!=d.parentId&&this.tree[d.parentId]?this.tree[d.parentId].addChild(d):this.roots.push(d));for(f=0;f<this.nodes.length;f++)d=this.nodes[f].updateBranchLeafClass();return this},c.prototype.move=function(b,c){var d=b.parentNode();return b!==c&&c.id!==b.parentId&&-1===a.inArray(b,c.ancestors())&&(b.setParent(c),this._moveRows(b,c),1===b.parentNode().children.length&&b.parentNode().render()),d&&d.updateBranchLeafClass(),b.parentNode()&&b.parentNode().updateBranchLeafClass(),b.updateBranchLeafClass(),this},c.prototype.removeNode=function(b){return this.unloadBranch(b),b.row.remove(),null!=b.parentId&&b.parentNode().removeChild(b),delete this.tree[b.id],this.nodes.splice(a.inArray(b,this.nodes),1),this},c.prototype.render=function(){var a,b,c,d;for(d=this.roots,b=0,c=d.length;b<c;b++)a=d[b],a.show();return this},c.prototype.sortBranch=function(a,b){return a.children.sort(b),this._sortChildRows(a),this},c.prototype.unloadBranch=function(a){var c,b=a.children.slice(0);for(c=0;c<b.length;c++)this.removeNode(b[c]);return a.children=[],a.updateBranchLeafClass(),this},c.prototype._moveRows=function(a,b){var d,c=a.children;for(a.row.insertAfter(b.row),a.render(),d=c.length-1;d>=0;d--)this._moveRows(c[d],a)},c.prototype._sortChildRows=function(a){return this._moveRows(a,a)},c}(),d={init:function(b,d){var e;return e=a.extend({branchAttr:"ttBranch",clickableNodeNames:!1,column:0,columnElType:"td",expandable:!1,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:19,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"Expand",stringCollapse:"Collapse",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null},b),this.each(function(){var f,b=a(this);return(d||void 0===b.data("treetable"))&&(f=new c(this,e),f.loadRows(this.rows).render(),b.addClass("treetable").data("treetable",f),null!=e.onInitialized&&e.onInitialized.apply(f)),b})},destroy:function(){return this.each(function(){return a(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){return this.data("treetable").collapseAll(),this},collapseNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.collapse(),this},expandAll:function(){return this.data("treetable").expandAll(),this},expandNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.initialized||b._initialize(),b.expand(),this},loadBranch:function(b,c){var d=this.data("treetable").settings,e=this.data("treetable").tree;if(c=a(c),null==b)this.append(c);else{var f=this.data("treetable").findLastNode(b);c.insertAfter(f.row)}return this.data("treetable").loadRows(c),c.filter("tr").each(function(){e[a(this).data(d.nodeIdAttr)].show()}),null!=b&&b.render().expand(),this},move:function(a,b){var c,d;return d=this.data("treetable").tree[a],c=this.data("treetable").tree[b],this.data("treetable").move(d,c),this},node:function(a){return this.data("treetable").tree[a]},removeNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return this.data("treetable").removeNode(b),this},reveal:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.reveal(),this},sortBranch:function(b,c){var f,d=this.data("treetable").settings;return c=c||d.column,f=c,a.isNumeric(c)&&(f=function(b,d){var e,f,g;return e=function(b){var d=b.row.find("td:eq("+c+")").text();return a.trim(d).toUpperCase()},f=e(b),g=e(d),f<g?-1:f>g?1:0}),this.data("treetable").sortBranch(b,f),this},unloadBranch:function(a){return this.data("treetable").unloadBranch(a),this}},a.fn.treetable=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?a.error("Method "+b+" does not exist on jQuery.treetable"):d.init.apply(this,arguments)},this.TreeTable||(this.TreeTable={}),this.TreeTable.Node=b,this.TreeTable.Tree=c}(jQuery);
